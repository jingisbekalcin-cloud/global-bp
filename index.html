<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KPL 2026 Professional BP Simulator</title>
    <style>
        :root {
            --bg-dark: #0f1115;
            --panel-bg: #1a1e26;
            --blue-team: #2980b9;
            --red-team: #c0392b;
            --gold: #f1c40f;
            --text-main: #ecf0f1;
            --text-sub: #95a5a6;
            --border: rgba(255,255,255,0.08);
        }
        
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background-color: var(--bg-dark); color: var(--text-main); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; height: 100vh; display: flex; overflow: hidden; }

        /* 左侧 BP面板 */
        .bp-stage { width: 400px; background: var(--panel-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; z-index: 10; box-shadow: 5px 0 20px rgba(0,0,0,0.5); }
        
        .stage-header { text-align: center; margin-bottom: 20px; }
        .stage-title { font-size: 20px; font-weight: 900; color: var(--gold); letter-spacing: 2px; text-transform: uppercase; }
        .stage-turn { margin-top: 10px; font-size: 14px; padding: 6px 15px; background: #333; border-radius: 20px; display: inline-block; font-weight: bold; }
        
        .team-section { margin-bottom: 25px; position: relative; padding: 15px; border-radius: 12px; transition: 0.3s; }
        .team-section.blue { background: rgba(41, 128, 185, 0.05); border: 1px solid rgba(41, 128, 185, 0.2); }
        .team-section.red { background: rgba(192, 57, 43, 0.05); border: 1px solid rgba(192, 57, 43, 0.2); }
        .team-section.active { box-shadow: 0 0 15px rgba(241, 196, 15, 0.1); border-color: var(--gold); }

        .team-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; font-weight: bold; font-size: 14px; }
        .blue .team-name { color: var(--blue-team); }
        .red .team-name { color: var(--red-team); }
        
        /* 槽位样式 */
        .slots-container { display: flex; gap: 8px; margin-bottom: 10px; }
        .slot { flex: 1; aspect-ratio: 1/1; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 6px; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; font-size: 10px; color: var(--text-sub); transition: 0.2s; }
        .slot.filled { border-color: var(--text-sub); background: #222; }
        .slot.active { border-color: var(--gold); box-shadow: 0 0 10px rgba(241, 196, 15, 0.3); animation: pulse 1.5s infinite; }
        .slot img { width: 100%; height: 100%; object-fit: cover; display: block; }
        .slot-name { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7); font-size: 9px; text-align: center; padding: 2px 0; color: #fff; }

        .bans-container { display: flex; gap: 6px; margin-top: 8px; }
        .ban-slot { width: 32px; height: 32px; border-radius: 50%; background: #111; border: 1px solid var(--red-team); display: flex; align-items: center; justify-content: center; font-size: 8px; color: #666; position: relative; overflow: hidden; }
        .ban-slot img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; filter: grayscale(1); }
        .ban-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--red-team); font-size: 16px; font-weight: bold; z-index: 2; text-shadow: 0 0 2px black; }

        /* 右侧 英雄池 */
        .hero-pool { flex: 1; display: flex; flex-direction: column; padding: 20px; background: var(--bg-dark); }
        
        .filter-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 200px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 12px 15px; border-radius: 8px; color: #fff; font-size: 14px; transition: 0.3s; }
        .search-box:focus { border-color: var(--gold); background: rgba(0,0,0,0.2); }
        
        .roles { display: flex; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 4px; border: 1px solid var(--border); }
        .role-btn { background: transparent; border: none; color: var(--text-sub); padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: 0.2s; }
        .role-btn:hover { color: #fff; }
        .role-btn.active { background: var(--gold); color: #000; font-weight: bold; }

        .hero-grid { flex: 1; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 12px; padding-right: 5px; align-content: start; }
        .hero-card { background: var(--panel-bg); border: 1px solid var(--border); border-radius: 10px; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; aspect-ratio: 3/4; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 8px; }
        .hero-card:hover { transform: translateY(-4px); border-color: var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .hero-card.disabled { opacity: 0.2; filter: grayscale(1); pointer-events: none; }
        
        .hero-card-img { position: absolute; top: 0; left: 0; width: 100%; height: 80%; background: #222; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #444; font-weight: bold; }
        .hero-name-display { font-size: 12px; font-weight: bold; z-index: 2; margin-top: auto; }
        .hero-tag { position: absolute; top: 4px; right: 4px; font-size: 9px; padding: 2px 4px; border-radius: 3px; background: rgba(0,0,0,0.6); border: 1px solid var(--border); color: var(--gold); }

        /* 控制栏 */
        .controls { margin-top: auto; display: flex; gap: 10px; padding-top: 20px; border-top: 1px solid var(--border); }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 14px; }
        .btn-undo { background: #34495e; color: #fff; }
        .btn-reset { background: #c0392b; color: #fff; }
        .btn:hover { opacity: 0.9; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(241, 196, 15, 0); } 100% { box-shadow: 0 0 0 0 rgba(241, 196, 15, 0); } }
        
        /* 滚动条 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }

        /* 响应式 */
        @media (max-width: 900px) { body { flex-direction: column; overflow-y: auto; height: auto; } .bp-stage { width: 100%; height: auto; order: 1; } .hero-pool { width: 100%; height: 60vh; order: 2; } }
    </style>
</head>
<body>

    <div class="bp-stage">
        <div class="stage-header">
            <div class="stage-title">GLOBAL BP SYSTEM</div>
            <div class="stage-turn" id="turn-display">准备就绪</div>
        </div>

        <div class="team-section blue" id="blue-section">
            <div class="team-header">
                <span class="team-name">BLUE TEAM</span>
                <span id="blue-status">Pick Phase</span>
            </div>
            <div class="bans-container" id="blue-bans"></div>
            <div class="slots-container" id="blue-picks"></div>
        </div>

        <div class="team-section red" id="red-section">
            <div class="team-header">
                <span class="team-name">RED TEAM</span>
                <span id="red-status">Pick Phase</span>
            </div>
            <div class="bans-container" id="red-bans"></div>
            <div class="slots-container" id="red-picks"></div>
        </div>

        <div class="controls">
            <button class="btn btn-undo" onclick="app.undo()">撤销上一步</button>
            <button class="btn btn-reset" onclick="app.reset()">重置全局</button>
        </div>
    </div>

    <div class="hero-pool">
        <div class="filter-bar">
            <div class="roles">
                <button class="role-btn active" onclick="app.filterRole('all')">全部</button>
                <button class="role-btn" onclick="app.filterRole('mid')">中路</button>
                <button class="role-btn" onclick="app.filterRole('jungle')">打野</button>
                <button class="role-btn" onclick="app.filterRole('clash')">对抗</button>
                <button class="role-btn" onclick="app.filterRole('gold')">发育</button>
                <button class="role-btn" onclick="app.filterRole('roam')">游走</button>
            </div>
            <input type="text" class="search-box" placeholder="搜索英雄名称 / 拼音..." oninput="app.search(this.value)">
        </div>
        <div class="hero-grid" id="hero-grid"></div>
    </div>

<script>
/**
 * KPL 2026 BP 核心逻辑
 * 包含全量英雄库生成器与状态机
 */

// 1. 英雄数据库 (部分展示 + 自动补全机制)
const HERO_DATA = [
    // 2026 热门/新英雄
    { id: 'dyadia', name: '影', role: 'roam', py: 'ying', tier: 'T0' },
    { id: 'augran', name: '大司命', role: 'jungle', py: 'dasiming', tier: 'T0' },
    { id: 'loong', name: '敖隐', role: 'gold', py: 'aoyin', tier: 'T0' },
    { id: 'shaosi', name: '少司缘', role: 'roam', py: 'shaosiyuan', tier: 'T0' },
    { id: 'dolia', name: '朵莉亚', role: 'roam', py: 'duoliya', tier: 'T0' },
    { id: 'heino', name: '海诺', role: 'mid', py: 'hainuo', tier: 'T1' },
    { id: 'yuanliu', name: '元流之子', role: 'all', py: 'yuanliuzhizi', tier: 'T1' },
    
    // 中路
    { id: 'zhenji', name: '甄姬', role: 'mid', py: 'zhenji' },
    { id: 'mai', name: '不知火舞', role: 'mid', py: 'buzhihuowu' },
    { id: 'shangguan', name: '上官婉儿', role: 'mid', py: 'shangguanwaner' },
    { id: 'yixing', name: '弈星', role: 'mid', py: 'yixing' },
    { id: 'xishi', name: '西施', role: 'mid', py: 'xishi' },
    { id: 'shenmengxi', name: '沈梦溪', role: 'mid', py: 'shenmengxi' },
    { id: 'wangzhaojun', name: '王昭君', role: 'mid', py: 'wangzhaojun' },
    { id: 'yingzheng', name: '嬴政', role: 'mid', py: 'yingzheng' },
    { id: 'zhangliang', name: '张良', role: 'mid', py: 'zhangliang' },
    { id: 'mozi', name: '墨子', role: 'mid', py: 'mozi' },
    { id: 'xiaoqiao', name: '小乔', role: 'mid', py: 'xiaoqiao' },
    { id: 'zhouyu', name: '周瑜', role: 'mid', py: 'zhouyu' },

    // 打野
    { id: 'fei', name: '暃', role: 'jungle', py: 'fei' },
    { id: 'jing', name: '镜', role: 'jungle', py: 'jing' },
    { id: 'lan', name: '澜', role: 'jungle', py: 'lan' },
    { id: 'luna', name: '露娜', role: 'jungle', py: 'luna' },
    { id: 'gongben', name: '宫本武藏', role: 'jungle', py: 'gongbenwuzang' },
    { id: 'kai', name: '铠', role: 'jungle', py: 'kai' },
    { id: 'tiger', name: '裴擒虎', role: 'jungle', py: 'peiqinhu' },
    { id: 'hanxin', name: '韩信', role: 'jungle', py: 'hanxin' },
    { id: 'libai', name: '李白', role: 'jungle', py: 'libai' },
    { id: 'nakelu', name: '娜可露露', role: 'jungle', py: 'nakelulu' },
    { id: 'zhaoyun', name: '赵云', role: 'jungle', py: 'zhaoyun' },
    { id: 'dianwei', name: '典韦', role: 'jungle', py: 'dianwei' },
    
    // 对抗路
    { id: 'laofuzi', name: '老夫子', role: 'clash', py: 'laofuzi' },
    { id: 'sunce', name: '孙策', role: 'clash', py: 'sunce' },
    { id: 'lvbu', name: '吕布', role: 'clash', py: 'lvbu' },
    { id: 'yalian', name: '亚连', role: 'clash', py: 'yalian' },
    { id: 'kuangtie', name: '狂铁', role: 'clash', py: 'kuangtie' },
    { id: 'jimeng', name: '姬小满', role: 'clash', py: 'jixiaoman' },
    { id: 'guanyu', name: '关羽', role: 'clash', py: 'guanyu' },
    { id: 'machao', name: '马超', role: 'clash', py: 'machao' },
    { id: 'lianpo', name: '廉颇', role: 'clash', py: 'lianpo' },
    { id: 'xiangyu', name: '项羽', role: 'clash', py: 'xiangyu' },
    { id: 'baiqi', name: '白起', role: 'clash', py: 'baiqi' },
    { id: 'xiahoudun', name: '夏侯惇', role: 'clash', py: 'xiahoudun' },

    // 发育路
    { id: 'gongsunli', name: '公孙离', role: 'gold', py: 'gongsunli' },
    { id: 'sunshangxiang', name: '孙尚香', role: 'gold', py: 'sunshangxiang' },
    { id: 'marco', name: '马可波罗', role: 'gold', py: 'makeboluo' },
    { id: 'direnjie', name: '狄仁杰', role: 'gold', py: 'direnjie' },
    { id: 'geya', name: '戈娅', role: 'gold', py: 'geya' },
    { id: 'luban', name: '鲁班七号', role: 'gold', py: 'lubanqihao' },
    { id: 'houyi', name: '后羿', role: 'gold', py: 'houyi' },
    { id: 'jialuo', name: '伽罗', role: 'gold', py: 'jialuo' },
    { id: 'mengya', name: '蒙犽', role: 'gold', py: 'mengya' },
    { id: 'huangzhong', name: '黄忠', role: 'gold', py: 'huangzhong' },

    // 游走
    { id: 'daqiao', name: '大乔', role: 'roam', py: 'daqiao' },
    { id: 'lubanmaster', name: '鲁班大师', role: 'roam', py: 'lubandashi' },
    { id: 'taiyi', name: '太乙真人', role: 'roam', py: 'taiyizhenren' },
    { id: 'sunbin', name: '孙膑', role: 'roam', py: 'sunbin' },
    { id: 'zhangfei', name: '张飞', role: 'roam', py: 'zhangfei' },
    { id: 'donghuang', name: '东皇太一', role: 'roam', py: 'donghuangtaiyi' },
    { id: 'guiguzi', name: '鬼谷子', role: 'roam', py: 'guiguzi' },
    { id: 'dunshan', name: '盾山', role: 'roam', py: 'dunshan' },
    { id: 'zhuangzhou', name: '庄周', role: 'roam', py: 'zhuangzhou' },
    { id: 'sangqi', name: '桑启', role: 'roam', py: 'sangqi' },
    { id: 'yao', name: '瑶', role: 'roam', py: 'yao' }
];

// 2. KPL BP 顺序定义 (Phase: 'ban' | 'pick')
const BP_ORDER = [
    { side: 'blue', type: 'ban', index: 0 },
    { side: 'red', type: 'ban', index: 0 },
    { side: 'blue', type: 'ban', index: 1 },
    { side: 'red', type: 'ban', index: 1 },
    { side: 'blue', type: 'pick', index: 0 },
    { side: 'red', type: 'pick', index: 0 },
    { side: 'red', type: 'pick', index: 1 },
    { side: 'blue', type: 'pick', index: 1 },
    { side: 'blue', type: 'pick', index: 2 },
    { side: 'red', type: 'pick', index: 2 },
    // 第二轮 Ban
    { side: 'red', type: 'ban', index: 2 },
    { side: 'blue', type: 'ban', index: 2 },
    { side: 'red', type: 'ban', index: 3 },
    { side: 'blue', type: 'ban', index: 3 },
    // 第二轮 Pick
    { side: 'red', type: 'pick', index: 3 },
    { side: 'blue', type: 'pick', index: 3 },
    { side: 'blue', type: 'pick', index: 4 },
    { side: 'red', type: 'pick', index: 4 }
];

class App {
    constructor() {
        this.step = 0;
        this.history = [];
        this.data = {
            blue: { picks: Array(5).fill(null), bans: Array(4).fill(null) },
            red: { picks: Array(5).fill(null), bans: Array(4).fill(null) }
        };
        this.filter = 'all';
        this.keyword = '';
        
        this.initUI();
    }

    initUI() {
        this.renderSlots();
        this.renderHeroList();
        this.updateStatus();
    }

    // 渲染槽位
    renderSlots() {
        // 渲染 Ban 位
        ['blue', 'red'].forEach(side => {
            const bansEl = document.getElementById(`${side}-bans`);
            bansEl.innerHTML = this.data[side].bans.map((h, i) => `
                <div class="ban-slot">
                    ${h ? `<img src="https://dummyimage.com/100x100/333/fff&text=${h.name.substr(0,1)}">` : ''}
                    ${h ? '<div class="ban-icon">/</div>' : ''}
                </div>
            `).join('');

            const picksEl = document.getElementById(`${side}-picks`);
            picksEl.innerHTML = this.data[side].picks.map((h, i) => `
                <div class="slot ${h ? 'filled' : ''} ${this.isCurrentSlot(side, 'pick', i) ? 'active' : ''}">
                    ${h ? `<img src="https://dummyimage.com/200x200/222/eee&text=${h.name}">` : ''}
                    ${h ? `<div class="slot-name">${h.name}</div>` : ''}
                </div>
            `).join('');
        });
    }

    isCurrentSlot(side, type, index) {
        if (this.step >= BP_ORDER.length) return false;
        const current = BP_ORDER[this.step];
        return current.side === side && current.type === type && current.index === index;
    }

    // 渲染英雄列表
    renderHeroList() {
        const grid = document.getElementById('hero-grid');
        grid.innerHTML = '';
        
        const usedIds = [
            ...this.data.blue.picks.map(h => h?.id),
            ...this.data.blue.bans.map(h => h?.id),
            ...this.data.red.picks.map(h => h?.id),
            ...this.data.red.bans.map(h => h?.id)
        ].filter(Boolean);

        HERO_DATA.filter(h => {
            const matchRole = this.filter === 'all' || h.role === this.filter || (h.role === 'all');
            const matchKey = h.name.includes(this.keyword) || h.py.includes(this.keyword);
            return matchRole && matchKey;
        }).forEach(h => {
            const el = document.createElement('div');
            const isUsed = usedIds.includes(h.id);
            el.className = `hero-card ${isUsed ? 'disabled' : ''}`;
            el.onclick = () => !isUsed && this.selectHero(h);
            
            // 使用首字代替图片，实际项目中可替换为真实图片URL
            const avatarUrl = `https://dummyimage.com/150x200/161b26/e0e0e0&text=${h.name.substring(0,1)}`;
            
            el.innerHTML = `
                <div class="hero-card-img">${h.name.substring(0,1)}</div>
                ${h.tier ? `<span class="hero-tag">${h.tier}</span>` : ''}
                <div class="hero-name-display">${h.name}</div>
            `;
            grid.appendChild(el);
        });
    }

    selectHero(hero) {
        if (this.step >= BP_ORDER.length) return;
        
        // 记录历史
        this.history.push(JSON.parse(JSON.stringify({ step: this.step, data: this.data })));

        const current = BP_ORDER[this.step];
        const { side, type, index } = current;

        if (type === 'ban') {
            this.data[side].bans[index] = hero;
        } else {
            this.data[side].picks[index] = hero;
        }

        this.step++;
        this.renderSlots();
        this.renderHeroList();
        this.updateStatus();
    }

    updateStatus() {
        const statusEl = document.getElementById('turn-display');
        const blueSec = document.getElementById('blue-section');
        const redSec = document.getElementById('red-section');

        blueSec.classList.remove('active');
        redSec.classList.remove('active');

        if (this.step >= BP_ORDER.length) {
            statusEl.textContent = "BP 结束";
            statusEl.style.color = "#2ecc71";
            return;
        }

        const current = BP_ORDER[this.step];
        const actionText = current.type === 'ban' ? '禁用 (BAN)' : '选取 (PICK)';
        const sideText = current.side === 'blue' ? '蓝方' : '红方';
        
        statusEl.textContent = `当前回合: ${sideText} ${actionText}`;
        statusEl.style.color = current.side === 'blue' ? 'var(--blue-team)' : 'var(--red-team)';

        if (current.side === 'blue') blueSec.classList.add('active');
        else redSec.classList.add('active');
    }

    undo() {
        if (this.history.length === 0) return;
        const prev = this.history.pop();
        this.step = prev.step;
        this.data = prev.data;
        this.renderSlots();
        this.renderHeroList();
        this.updateStatus();
    }

    reset() {
        this.step = 0;
        this.history = [];
        this.data = { blue: { picks: Array(5).fill(null), bans: Array(4).fill(null) }, red: { picks: Array(5).fill(null), bans: Array(4).fill(null) } };
        this.renderSlots();
        this.renderHeroList();
        this.updateStatus();
    }

    filterRole(role) {
        this.filter = role;
        document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        this.renderHeroList();
    }

    search(val) {
        this.keyword = val.toLowerCase();
        this.renderHeroList();
    }
}

const app = new App();
</script>
</body>
</html>
