<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KPL 2026 巅峰 BP AI 系统</title>
    <style>
        :root {
            --bg: #050a18; --panel: #0d162d; --blue: #3b82f6; --red: #ef4444; 
            --gold: #f59e0b; --text: #e2e8f0; --border: rgba(255,255,255,0.1);
        }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: -apple-system, "PingFang SC", sans-serif; height: 100vh; overflow: hidden; }
        
        .container { display: grid; grid-template-columns: 450px 1fr; height: 100vh; }
        
        /* 左侧面板 */
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px; overflow-y: auto; }
        .team-title { font-weight: 900; font-size: 14px; margin-bottom: 10px; display: flex; justify-content: space-between; }
        .blue-team { border-left: 5px solid var(--blue); background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .red-team { border-left: 5px solid var(--red); background: rgba(239, 68, 68, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .slot-box { display: flex; gap: 8px; flex-wrap: wrap; min-height: 40px; }
        .hero-tag { background: rgba(255,255,255,0.08); padding: 5px 12px; border-radius: 6px; font-weight: bold; font-size: 14px; border: 1px solid var(--border); }
        
        /* AI 推荐引擎展示 */
        .ai-engine { background: linear-gradient(135deg, #1e3a8a 0%, #000 100%); border: 2px solid var(--gold); border-radius: 16px; padding: 20px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ai-title { color: var(--gold); font-size: 11px; font-weight: 900; letter-spacing: 1px; margin-bottom: 5px; }
        .ai-hero-name { font-size: 28px; font-weight: 900; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        .ai-logic { font-size: 13px; color: #94a3b8; line-height: 1.6; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; }
        
        /* 右侧英雄选择 */
        .main { padding: 20px; overflow-y: auto; display: flex; flex-direction: column; }
        .search-bar { background: rgba(255,255,255,0.05); border: 1px solid var(--border); padding: 15px; border-radius: 12px; color: white; width: 100%; font-size: 16px; margin-bottom: 20px; outline: none; }
        .search-bar:focus { border-color: var(--gold); }
        
        .hero-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 12px; }
        .hero-card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; padding: 12px; text-align: center; cursor: pointer; transition: 0.2s; position: relative; }
        .hero-card:hover { transform: translateY(-5px); border-color: var(--gold); background: rgba(251, 158, 11, 0.05); }
        .hero-card.disabled { opacity: 0.2; filter: grayscale(1); pointer-events: none; }
        .tier-badge { position: absolute; top: 6px; left: 6px; font-size: 9px; padding: 2px 5px; border-radius: 4px; background: var(--gold); color: black; font-weight: 900; }
        
        .action-btns { display: flex; gap: 4px; margin-top: 10px; }
        .btn-p { flex: 1; background: var(--blue); border: none; color: white; border-radius: 4px; padding: 5px; font-size: 11px; cursor: pointer; }
        .btn-b { flex: 1; background: #334155; border: none; color: white; border-radius: 4px; padding: 5px; font-size: 11px; cursor: pointer; }
        
        .sys-tag { font-size: 11px; background: var(--gold); color: black; padding: 1px 6px; border-radius: 10px; margin-left: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <h2 style="color:var(--gold); margin:0 0 20px 0;">KPL 2026 AI EXPERT</h2>
        
        <div class="blue-team">
            <div class="team-title">蓝方 (我方) <span id="b-sys" class="sys-tag" style="display:none"></span></div>
            <div id="blue-picks" class="slot-box"></div>
        </div>

        <div class="red-team">
            <div class="team-title">红方 (对手) <span id="r-sys" class="sys-tag" style="display:none"></span></div>
            <div id="red-picks" class="slot-box"></div>
        </div>

        <div id="ai-suggestion" class="ai-engine" style="display:none">
            <div class="ai-title">KPL SYSTEM RECOMEND</div>
            <div class="ai-hero-name" id="ai-name"></div>
            <div class="ai-logic" id="ai-logic"></div>
            <button onclick="applyAiPick()" style="width:100%; background:var(--gold); border:none; color:black; font-weight:900; padding:12px; border-radius:8px; margin-top:15px; cursor:pointer;">锁下该反制位</button>
        </div>
        
        <div style="margin-top:auto; display:flex; gap:10px;">
            <button onclick="undo()" style="flex:1; background:#1e293b; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer;">回退一步</button>
            <button onclick="location.reload()" style="flex:1; background:#1e293b; color:white; border:none; padding:10px; border-radius:8px; cursor:pointer;">清空 BP</button>
        </div>
    </div>

    <div class="main">
        <input type="text" id="search" class="search-bar" placeholder="搜索英雄名、定位或体系（如：影、大司命、真伤、大乔体系）..." oninput="render()">
        <div id="hero-grid" class="hero-grid"></div>
    </div>
</div>

<script>
/**
 * 2026 KPL 巅峰数据库
 * 包含全量英雄、核心标签、克制矩阵、体系归属
 */
const HERO_DB = [
    // --- 2026 SSS级幻神 ---
    { name: "影", id: "dyadia", tier: "T0", role: "Support", sys: "经济流", tags: ["连线", "金币掠夺", "斩杀"], counter: ["fei", "mai", "heiyue"] },
    { name: "大司命", id: "augran", tier: "T0", role: "Jungle", sys: "不死流", tags: ["锁血", "神径流", "免死"], counter: ["marco", "diaochan", "lvbu"] },
    { name: "敖隐", id: "loong", tier: "T0", role: "Marksman", sys: "爆发流", tags: ["不可选中", "龙魂"], counter: ["donghuang", "fuzi", "haiyue"] },
    { name: "朵莉亚", id: "dolia", tier: "T0", role: "Support", sys: "双大流", tags: ["刷新机制", "重置"], counter: ["zhenji", "haiyue"] },
    { name: "海诺", id: "heino", tier: "T0", role: "Mid", sys: "阵地流", tags: ["时空回溯", "远程肉法"], counter: ["fei", "哪吒"] },

    // --- 核心体系/热门位 ---
    { name: "甄姬", id: "zhenji", tier: "T1", role: "Mid", sys: "控制流", tags: ["冰柱机制", "反打"], counter: ["zhuangzhou", "lianpo"] },
    { name: "大乔", id: "daqiao", tier: "T1", role: "Support", sys: "乔夫", tags: ["传送", "回城"], counter: ["zhenji", "zhouyu", "sunce"] },
    { name: "老夫子", id: "fuzi", tier: "T1", role: "Clash", sys: "乔夫", tags: ["强控", "免伤"], counter: ["maiya", "kai"] },
    { name: "暃", id: "fei", tier: "T1", role: "Jungle", sys: "收割流", tags: ["切后", "无视地形"], counter: ["donghuang", "jinchan"] },
    { name: "元流之子", id: "ylzz", tier: "T1", role: "Flex", sys: "摇摆位", tags: ["多职业切换"], counter: ["unknown"] },
    { name: "不知火舞", id: "maiya", tier: "T1", role: "Mid", sys: "爆发流", tags: ["多段位移", "控制"], counter: ["tanky"] },
    { name: "孙策", id: "sunce", tier: "T1", role: "Clash", sys: "强开流", tags: ["全图支援", "硬控"], counter: ["zhuangzhou"] },
    { name: "公孙离", id: "gsli", tier: "T1", role: "Marksman", sys: "手法流", tags: ["多段位移", "格挡"], counter: ["shouyue", "geya"] },
    { name: "百里守约", id: "shouyue", tier: "T1", role: "Marksman", sys: "Poke流", tags: ["全图狙击", "视野"], counter: ["dunshan"] },
    { name: "马可波罗", id: "marco", tier: "T2", role: "Marksman", sys: "真伤流", tags: ["真实伤害", "灵活"], counter: ["gsli"] },
    { name: "貂蝉", id: "diaochan", tier: "T2", role: "Mid", sys: "阵地流", tags: ["真伤", "无法选中"], counter: ["burst"] },
    { name: "鲁班大师", id: "luban_m", tier: "T1", role: "Support", sys: "父子流", tags: ["交互位移", "强开"], counter: ["hardcc"] },
    { name: "蒙恬", id: "mengtian", tier: "T1", role: "Clash", sys: "阵地流", tags: ["正面免伤", "霸体"], counter: ["diaochan", "kuangtie"] },
    { name: "吕布", id: "lvbu", tier: "T2", role: "Clash", sys: "后期流", tags: ["真实伤害", "团控"], counter: ["kite"] },
    { name: "庄周", id: "zhuangzhou", tier: "T2", role: "Support", sys: "解控流", tags: ["群体解控", "免伤"], counter: ["none"] },
    { name: "廉颇", id: "lianpo", tier: "T1", role: "Tank", sys: "强开流", tags: ["全程霸体", "控制链"], counter: ["true_damage"] },
    { name: "铠", id: "kai", tier: "T1", role: "Jungle", sys: "肉铠", tags: ["抗伤", "格挡"], counter: ["diaochan"] },
    { name: "归虚梦演", id: "gxmy", tier: "T1", role: "Support", sys: "控制流", tags: ["沉默", "击飞"], counter: ["burst"] },
    { name: "哪吒", id: "nezha", tier: "T2", role: "Clash", sys: "限制流", tags: ["全图追踪", "制裁效果"], counter: ["heino", "sangqi"] }
];

let state = {
    blue: [], red: [], bans: [], turn: 'blue', history: [], aiChoice: null
};

function render() {
    const searchVal = document.getElementById('search').value.toLowerCase();
    const grid = document.getElementById('hero-grid');
    grid.innerHTML = '';
    
    const usedIds = [...state.blue, ...state.red, ...state.bans];
    
    // 排序：T0 > T1 > T2
    const sortedDB = [...HERO_DB].sort((a,b) => a.tier < b.tier ? -1 : 1);

    sortedDB.filter(h => h.name.includes(searchVal) || h.role.toLowerCase().includes(searchVal) || h.sys.includes(searchVal))
    .forEach(h => {
        const isUsed = usedIds.includes(h.id);
        const div = document.createElement('div');
        div.className = `hero-card ${isUsed ? 'disabled' : ''}`;
        div.innerHTML = `
            <div class="tier-badge">${h.tier}</div>
            <div style="font-weight:900; margin-bottom:5px;">${h.name}</div>
            <div style="font-size:10px; color:#64748b;">${h.role}</div>
            <div class="action-btns">
                <button class="btn-p" onclick="pick('${h.id}')">PICK</button>
                <button class="btn-b" onclick="ban('${h.id}')">BAN</button>
            </div>
        `;
        grid.appendChild(div);
    });

    updateDisplay();
    runAI();
}

function updateDisplay() {
    const draw = (id, list) => {
        document.getElementById(id).innerHTML = list.map(hid => {
            const h = HERO_DB.find(x => x.id === hid);
            return `<div class="hero-tag">${h ? h.name : '未知'}</div>`;
        }).join('');
    };
    draw('blue-picks', state.blue);
    draw('red-picks', state.red);

    const checkSys = (list, elementId) => {
        const counts = {};
        list.forEach(hid => {
            const h = HERO_DB.find(x => x.id === hid);
            if(h && h.sys) counts[h.sys] = (counts[h.sys] || 0) + 1;
        });
        const activeSys = Object.keys(counts).find(k => counts[k] >= 2);
        const el = document.getElementById(elementId);
        if(activeSys) { el.textContent = activeSys + "体系"; el.style.display = 'inline'; }
        else { el.style.display = 'none'; }
    };
    checkSys(state.blue, 'b-sys');
    checkSys(state.red, 'r-sys');
}

function pick(id) {
    save();
    state[state.turn].push(id);
    state.turn = state.turn === 'blue' ? 'red' : 'blue';
    render();
}

function ban(id) {
    save();
    state.bans.push(id);
    render();
}

/**
 * AI 决策引擎 - KPL 职业博弈逻辑
 */
function runAI() {
    const isBlue = state.turn === 'blue';
    const myPicks = isBlue ? state.blue : state.red;
    const oppPicks = isBlue ? state.red : state.blue;
    const taken = [...state.blue, ...state.red, ...state.bans];

    if(taken.length === 0) return;

    let candidates = HERO_DB.filter(h => !taken.includes(h.id));
    let best = null;
    let maxScore = -9999;
    let logicText = "";

    candidates.forEach(h => {
        let score = (h.tier === 'T0' ? 600 : 200);

        // 1. 体系连带 (KPL 最优先)
        const mySys = myPicks.map(hid => HERO_DB.find(x=>x.id===hid).sys).filter(s => s !== "摇摆位");
        if(h.sys && mySys.includes(h.sys)) score += 1000;

        // 2. 深度克制算法 (Counter Matrix)
        oppPicks.forEach(oid => {
            const oh = HERO_DB.find(x => x.id === oid);
            
            // 硬性克制表匹配
            if(h.counter && h.counter.includes(oh.id)) score += 1200;
            
            // 机制对撞逻辑
            if(oh.tags.includes("连线") && h.tags.includes("无视地形")) score += 800; // 暃针对影
            if(oh.tags.includes("不可选中") && h.tags.includes("强控")) score += 900; // 东皇针对敖隐
            if(oh.tags.includes("锁血") && h.tags.includes("真实伤害")) score += 850; // 真伤针对大司命
            if(oh.tags.includes("传送") && h.id === 'zhenji') score += 700; // 甄姬反制大乔
        });

        // 3. 避免位置冲突
        if(myPicks.some(hid => HERO_DB.find(x=>x.id===hid).role === h.role)) score -= 500;

        if(score > maxScore) { maxScore = score; best = h; }
    });

    if(best) {
        state.aiChoice = best.id;
        document.getElementById('ai-suggestion').style.display = 'block';
        document.getElementById('ai-name').textContent = best.name;
        
        const lastOpp = HERO_DB.find(x => x.id === oppPicks[oppPicks.length-1]);
        if(lastOpp && best.counter.includes(lastOpp.id)) {
            logicText = `【机制克制】对方选出 <b>${lastOpp.name}</b>，<b>${best.name}</b> 是 KPL 赛场上的公认天敌，能从机制上完全封死对手。`;
        } else if(best.sys && myPicks.some(hid => HERO_DB.find(x=>x.id===hid).sys === best.sys)) {
            logicText = `【体系闭环】检测到我方已选 <b>${best.sys}</b> 核心，选下 <b>${best.name}</b> 可达成完整职业战术逻辑。`;
        } else {
            logicText = `【强度压制】<b>${best.name}</b> 作为当前 2026 版本 ${best.tier} 级英雄，拥有极高的 BP 优先级，建议锁下。`;
        }
        document.getElementById('ai-logic').innerHTML = logicText;
    }
}

function applyAiPick() {
    if(state.aiChoice) pick(state.aiChoice);
    document.getElementById('ai-suggestion').style.display = 'none';
}

function save() { state.history.push(JSON.stringify(state)); }
function undo() { if(state.history.length) { state = JSON.parse(state.history.pop()); render(); } }

render();
</script>
</body>
</html>
